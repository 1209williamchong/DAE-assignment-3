<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>開源軟體清單</title>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" />
    <style>
        ion-list {
            padding: 8px;
        }
        ion-item {
            --inner-padding-end: 8px;
            --padding-start: 8px;
            --border-radius: 5px;
            margin-bottom: 8px;
            --background: #fff;
            animation: fadeIn 0.3s ease-in;
        }
        .item-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            width: 100%;
        }
        .software-icon {
            width: 44px;
            height: 44px;
            margin-right: 8px;
            border-radius: 5px;
            object-fit: contain;
        }
        .software-details {
            flex-grow: 1;
        }
        .software-details ion-label {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .software-details ion-note {
            font-size: 12px;
            line-height: 1.4;
            display: block;
            margin-bottom: 4px;
        }
        .category-tag {
            color: var(--ion-color-primary);
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            min-width: 44px;
            text-align: center;
            transition: background-color 0.2s;
        }
        .category-tag.selected {
            background-color: var(--ion-color-primary);
            color: white;
        }
        .video-container {
            margin-top: 8px;
            position: relative;
        }
        .video-container iframe {
            width: 100%;
            max-width: 343px;
            height: 150px;
            border: none;
        }
        .video-error {
            padding: 8px;
            text-align: center;
        }
        .video-error p {
            margin: 0;
        }
        .no-results {
            text-align: center;
            padding: 16px;
            color: #888;
            font-size: 14px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 375px) {
            ion-searchbar {
                --padding-start: 8px;
                --padding-end: 8px;
                font-size: 14px;
            }
            ion-select, ion-toggle {
                font-size: 14px;
            }
            ion-datetime-button {
                --padding-end: 8px;
            }
            ion-item {
                padding: 6px;
                margin-bottom: 6px;
            }
            .software-icon {
                width: 40px;
                height: 40px;
            }
            .software-details ion-label {
                font-size: 14px;
            }
            .software-details ion-note {
                font-size: 11px;
            }
            .video-container iframe {
                max-width: 100%;
                height: 140px;
            }
            .video-error {
                font-size: 11px;
                padding: 6px;
            }
            .category-tag {
                padding: 2px 4px;
                font-size: 11px;
            }
        }
        ion-content {
            --padding-bottom: 120px;
        }
    </style>
</head>
<body>
    <ion-app>
        <ion-header>
            <ion-toolbar>
                <ion-title>開源軟體清單</ion-title>
            </ion-toolbar>
            <ion-searchbar id="searchInput" placeholder="搜尋..." debounce="300"></ion-searchbar>
            <ion-item>
                <ion-select label="排序方式" id="sortSelect" interface="popover" value="name">
                    <ion-select-option value="name">名稱</ion-select-option>
                    <ion-select-option value="version">版本</ion-select-option>
                </ion-select>
                <ion-toggle id="sortDirection" slot="end" checked>降冪</ion-toggle>
            </ion-item>
            <ion-item>
                <ion-select label="分類" interface="popover" id="categorySelect" multiple="true">
                    <ion-select-option value="">全部</ion-select-option>
                    <ion-select-option value="網頁瀏覽器">網頁瀏覽器</ion-select-option>
                    <ion-select-option value="作業系統">作業系統</ion-select-option>
                    <ion-select-option value="辦公室軟體">辦公室軟體</ion-select-option>
                    <ion-select-option value="圖像編輯器">圖像編輯器</ion-select-option>
                    <ion-select-option value="版本控制">版本控制</ion-select-option>
                    <ion-select-option value="程式設計工具">程式設計工具</ion-select-option>
                    <ion-select-option value="資料庫">資料庫</ion-select-option>
                    <ion-select-option value="媒體播放器">媒體播放器</ion-select-option>
                    <ion-select-option value="檔案管理">檔案管理</ion-select-option>
                    <ion-select-option value="網頁伺服器">網頁伺服器</ion-select-option>
                </ion-select>
            </ion-item>
            <ion-item>
                <ion-label>日期範圍</ion-label>
                <ion-datetime-button datetime="startDate"></ion-datetime-button>
                <ion-datetime-button datetime="endDate"></ion-datetime-button>
            </ion-item>
            <ion-modal>
                <ion-datetime id="startDate" presentation="date" max="2025-12-31"></ion-datetime>
                <ion-datetime id="endDate" presentation="date" max="2025-12-31"></ion-datetime>
            </ion-modal>
        </ion-header>
        <ion-content class="ion-padding">
            <ion-list id="softwareListContainer"></ion-list>
        </ion-content>
    </ion-app>
    <script>
        const softwareData = [
            {
                name: "Mozilla Firefox",
                version: "125.0.1",
                license: "Mozilla Public License 2.0",
                category: "網頁瀏覽器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Firefox_logo_2017.svg/800px-Firefox_logo_2017.svg.png",
                video: "https://www.youtube.com/embed/agboT1w_e4g",
                description: "Mozilla Firefox 是一款快速、安全的開源網頁瀏覽器，支持眾多擴充功能。",
                date: "2025-04-01"
            },
            {
                name: "Linux (Ubuntu)",
                version: "24.04 LTS",
                license: "GNU General Public License (GPL)",
                category: "作業系統",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Tux.svg/800px-Tux.svg.png",
                video: "https://www.youtube.com/embed/mS4Ci-zZ9A4",
                description: "Ubuntu 是基於 Linux 的開源作業系統，適合桌面和伺服器使用。",
                date: "2025-04-15"
            },
            {
                name: "LibreOffice",
                version: "24.2.3",
                license: "Mozilla Public License v2.0",
                category: "辦公室軟體",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/LibreOffice_logo.svg/800px-LibreOffice_logo.svg.png",
                video: "https://www.youtube.com/embed/nF0-612j61I",
                description: "LibreOffice 是一套免費的開源辦公軟體，包含文書、試算表等工具。",
                date: "2025-03-10"
            },
            {
                name: "GIMP",
                version: "2.10.36",
                license: "GNU General Public License v3.0",
                category: "圖像編輯器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/GIMP_logo.svg/800px-GIMP_logo.svg.png",
                video: "https://www.youtube.com/embed/9ylj97R3R7s",
                description: "GIMP 是一款功能強大的開源圖像編輯軟體，類似 Photoshop。",
                date: "2025-02-20"
            },
            {
                name: "Git",
                version: "2.45.0",
                license: "GNU General Public License v2.0",
                category: "版本控制",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Git-logo.svg/800px-Git-logo.svg.png",
                video: "https://www.youtube.com/embed/qw--VYLhZUE",
                description: "Git 是一款分散式版本控制系統，廣泛用於程式碼管理。",
                date: "2025-04-05"
            },
            {
                name: "Visual Studio Code",
                version: "1.88.0",
                license: "MIT License",
                category: "程式設計工具",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Visual_Studio_Code_1.35_icon.svg/800px-Visual_Studio_Code_1.35_icon.svg.png",
                video: "https://www.youtube.com/embed/KMxo3T_MTvY",
                description: "VS Code 是一款輕量、強大的開源程式碼編輯器。",
                date: "2025-03-15"
            },
            {
                name: "MySQL",
                version: "8.4.0",
                license: "GNU General Public License v2.0",
                category: "資料庫",
                icon: "https://upload.wikimedia.org/wikipedia/en/thumb/5/5a/MySQL.svg/800px-MySQL.svg.png",
                video: "https://www.youtube.com/embed/OM4aZJW_Ojs",
                description: "MySQL 是一款高效的開源關聯式資料庫管理系統。",
                date: "2025-01-10"
            },
            {
                name: "VLC Media Player",
                version: "3.0.21",
                license: "GNU General Public License v2.0",
                category: "媒體播放器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/VLC_media_player_Logo.svg/800px-VLC_media_player_Logo.svg.png",
                video: "https://www.youtube.com/embed/FhX4F61KHDA",
                description: "VLC 是一款支援多格式的開源媒體播放器。",
                date: "2025-02-15"
            },
            {
                name: "Inkscape",
                version: "1.4.0",
                license: "GNU General Public License v3.0",
                category: "圖像編輯器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Inkscape_logo.svg/800px-Inkscape_logo.svg.png",
                video: "https://www.youtube.com/embed/7N0O4KH6ToU",
                description: "Inkscape 是一款用於向量圖形的開源編輯工具。",
                date: "2025-03-01"
            },
            {
                name: "Apache HTTP Server",
                version: "2.4.62",
                license: "Apache License 2.0",
                category: "網頁伺服器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Apache_HTTP_server_logo_%282016%29.svg/800px-Apache_HTTP_server_logo_%282016%29.svg.png",
                video: "https://www.youtube.com/embed/ZF7iY8pTXcg",
                description: "Apache 是全球廣泛使用的開源網頁伺服器軟體。",
                date: "2025-04-10"
            },
            {
                name: "Eclipse",
                version: "4.31.0",
                license: "Eclipse Public License 2.0",
                category: "程式設計工具",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Logo_Eclipse.svg/800px-Logo_Eclipse.svg.png",
                video: "https://www.youtube.com/embed/UCHM5hnX3Z8",
                description: "Eclipse 是一款開源的整合開發環境，適合 Java 開發。",
                date: "2025-02-10"
            },
            {
                name: "PostgreSQL",
                version: "17.0",
                license: "PostgreSQL License",
                category: "資料庫",
                icon: "https://upload.wikimedia.org/wikipedia/en/thumb/7/7c/PostgreSQL_logo.svg/800px-PostgreSQL_logo.svg.png",
                video: "https://www.youtube.com/embed/UxS7Mak7l8U",
                description: "PostgreSQL 是一款強大的開源物件關聯式資料庫。",
                date: "2025-03-20"
            },
            {
                name: "7-Zip",
                version: "24.03",
                license: "GNU Lesser General Public License",
                category: "檔案管理",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/7-Zip_Logo.svg/800px-7-Zip_Logo.svg.png",
                video: "https://www.youtube.com/embed/U1yA2i-xL6Q",
                description: "7-Zip 是一款高效的開源檔案壓縮工具。",
                date: "2025-01-15"
            },
            {
                name: "Chromium",
                version: "124.0.6367.0",
                license: "BSD License",
                category: "網頁瀏覽器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/Chromium_Logo.svg/800px-Chromium_Logo.svg.png",
                video: "https://www.youtube.com/embed/2k4I1v6m5pQ",
                description: "Chromium 是 Chrome 的開源基礎，注重隱私和性能。",
                date: "2025-04-03"
            },
            {
                name: "Debian",
                version: "12.5",
                license: "GNU General Public License",
                category: "作業系統",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Debian_logo.svg/800px-Debian_logo.svg.png",
                video: "https://www.youtube.com/embed/YuD3jP7YvAc",
                description: "Debian 是一款穩定、靈活的開源 Linux 發行版。",
                date: "2025-02-25"
            },
            {
                name: "Node.js",
                version: "22.0.0",
                license: "MIT License",
                category: "程式設計工具",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Node.js_logo.svg/800px-Node.js_logo.svg.png",
                video: "https://www.youtube.com/embed/TlB_eWDSMt4",
                description: "Node.js 是基於 JavaScript 的開源伺服器執行環境。",
                date: "2025-04-12"
            },
            {
                name: "Audacity",
                version: "3.5.0",
                license: "GNU General Public License v2.0",
                category: "媒體播放器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Audacity_Logo.svg/800px-Audacity_Logo.svg.png",
                video: "https://www.youtube.com/embed/0gO0Ez4vMUI",
                description: "Audacity 是一款開源的音訊編輯和錄製軟體。",
                date: "2025-03-05"
            },
            {
                name: "FileZilla",
                version: "3.67.0",
                license: "GNU General Public License v2.0",
                category: "檔案管理",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/FileZilla_Logo.svg/800px-FileZilla_Logo.svg.png",
                video: "https://www.youtube.com/embed/2oqXRVwH_ao",
                description: "FileZilla 是一款開源的 FTP 檔案傳輸工具。",
                date: "2025-02-05"
            },
            {
                name: "NGINX",
                version: "1.26.0",
                license: "BSD License",
                category: "網頁伺服器",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Nginx_logo.svg/800px-Nginx_logo.svg.png",
                video: "https://www.youtube.com/embed/1iZMgQPUmWo",
                description: "NGINX 是一款高效的開源網頁伺服器和反向代理。",
                date: "2025-01-20"
            },
            {
                name: "Apache OpenOffice",
                version: "4.1.16",
                license: "Apache License 2.0",
                category: "辦公室軟體",
                icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/OpenOffice_logo.svg/800px-OpenOffice_logo.svg.png",
                video: "https://www.youtube.com/embed/5dOnaa6vY00",
                description: "Apache OpenOffice 是一套開源辦公軟體，支援多種文件格式。",
                date: "2025-04-08"
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const categorySelect = document.getElementById('categorySelect');
            const sortSelect = document.getElementById('sortSelect');
            const sortDirection = document.getElementById('sortDirection');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const container = document.getElementById('softwareListContainer');

            let activeTags = [];

            // 動態生成 ion-item
            function createSoftwareItem(data) {
                const item = document.createElement('ion-item');
                item.dataset.category = data.category;
                item.dataset.date = data.date;
                item.innerHTML = `
                    <div class="item-header">
                        <img src="${data.icon}" alt="${data.name} 圖示" class="software-icon">
                        <div class="software-details">
                            <ion-label>${data.name}</ion-label>
                            <ion-note><span class="detail-label">版本：</span>${data.version}</ion-note>
                            <ion-note><span class="detail-label">授權條款：</span>${data.license}</ion-note>
                            <ion-note><span class="detail-label">用途：</span><span class="category-tag">${data.category}</span></ion-note>
                        </div>
                    </div>
                    <div class="video-container" data-video="${data.video}">
                        <iframe data-src="${data.video}" title="${data.name} 示範影片" frameborder="0" allowfullscreen></iframe>
                        <div class="video-error" style="display: none;">
                            <p style="color: red; font-size: 12px;">影片無法播放，請稍後重試</p>
                            <p style="font-size: 12px;">${data.description}</p>
                        </div>
                    </div>
                `;
                return item;
            }

            const softwareItems = softwareData.map(data => createSoftwareItem(data));

            // 延遲載入影片
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const iframe = entry.target.querySelector('iframe');
                        const errorDiv = entry.target.querySelector('.video-error');
                        iframe.src = iframe.dataset.src;
                        iframe.onerror = () => {
                            iframe.style.display = 'none';
                            errorDiv.style.display = 'block';
                        };
                        observer.unobserve(entry.target);
                    }
                });
            }, { rootMargin: '0px 0px 100px 0px' });

            // 綁定觀察
            function bindObservers() {
                container.querySelectorAll('.video-container').forEach(container => {
                    const iframe = container.querySelector('iframe');
                    if (iframe && !iframe.src) {
                        observer.observe(container);
                    }
                });
            }

            // 綁定標籤事件
            function bindTagEvents() {
                container.querySelectorAll('.category-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        const category = tag.textContent;
                        if (activeTags.includes(category)) {
                            activeTags = activeTags.filter(t => t !== category);
                            tag.classList.remove('selected');
                        } else {
                            activeTags.push(category);
                            tag.classList.add('selected');
                        }
                        applyFilters();
                    });
                });
            }

            // 解析版本號
            function parseVersion(str) {
                const versionMatch = str.match(/[\d\.]+(?:\s*LTS)?/);
                if (!versionMatch) return [0];
                const version = versionMatch[0].replace(/\s*LTS/, '');
                return version.split('.').map(Number);
            }

            // 比較版本號
            function compareVersions(a, b) {
                const aParts = parseVersion(a);
                const bParts = parseVersion(b);
                for (let i = 0; i < Math.max(aParts.length, bParts.length); i++) {
                    const aVal = aParts[i] || 0;
                    const bVal = bParts[i] || 0;
                    if (aVal !== bVal) return aVal - bVal;
                }
                return 0;
            }

            // 解析日期
            function parseDate(str) {
                return str ? new Date(str) : null;
            }

            // 應用過濾與排序
            function applyFilters() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategories = Array.isArray(categorySelect.value) ? categorySelect.value.filter(v => v !== '') : [];
                const sortBy = sortSelect.value;
                const isDescending = sortDirection.checked;
                const startDate = parseDate(startDateInput.value);
                const endDate = parseDate(endDateInput.value);

                let filtered = softwareItems.filter(item => {
                    const title = item.querySelector('ion-label').textContent.toLowerCase();
                    const desc = item.querySelector('ion-note:nth-child(3)').textContent.toLowerCase();
                    const videoDesc = item.querySelector('.video-error p:nth-child(2)')?.textContent.toLowerCase() || '';
                    const category = item.dataset.category;
                    const itemDate = parseDate(item.dataset.date);

                    const matchesSearch = title.includes(searchTerm) || desc.includes(searchTerm) || videoDesc.includes(searchTerm);
                    const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(category);
                    const matchesTags = activeTags.length === 0 || activeTags.includes(category);
                    const matchesDate = (!startDate || (itemDate && itemDate >= startDate)) &&
                                       (!endDate || (itemDate && itemDate <= endDate));

                    return matchesSearch && matchesCategory && matchesTags && matchesDate;
                });

                // 排序
                filtered.sort((a, b) => {
                    let aVal, bVal;
                    if (sortBy === 'name') {
                        aVal = a.querySelector('ion-label').textContent.toLowerCase();
                        bVal = b.querySelector('ion-label').textContent.toLowerCase();
                        return aVal.localeCompare(bVal);
                    } else if (sortBy === 'version') {
                        aVal = a.querySelector('ion-note').textContent;
                        bVal = b.querySelector('ion-note').textContent;
                        return compareVersions(aVal, bVal);
                    }
                    return 0;
                });

                if (isDescending) filtered.reverse();

                // 更新 DOM
                container.innerHTML = '';
                if (filtered.length === 0) {
                    container.innerHTML = '<p class="no-results">無符合結果</p>';
                } else {
                    filtered.forEach(item => container.appendChild(item));
                    bindTagEvents();
                    bindObservers();
                }
            }

            // 綁定事件
            searchInput.addEventListener('ionInput', applyFilters);
            categorySelect.addEventListener('ionChange', applyFilters);
            sortSelect.addEventListener('ionChange', applyFilters);
            sortDirection.addEventListener('ionChange', applyFilters);
            startDateInput.addEventListener('ionChange', applyFilters);
            endDateInput.addEventListener('ionChange', applyFilters);

            // 初始化
            applyFilters();
            bindObservers();
        });
    </script>
</body>
</html>